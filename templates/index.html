<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SplitEase - Money Splitting App</title>
    <script src="https://unpkg.com/htmx.org@2.0.3"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f5f3ff",
                100: "#ede9fe",
                200: "#ddd6fe",
                300: "#c4b5fd",
                400: "#a78bfa",
                500: "#8b5cf6",
                600: "#7c3aed",
                700: "#6d28d9",
                800: "#5b21b6",
                900: "#4c1d95",
              },
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap");

      body {
        font-family: "Inter", sans-serif;
      }

      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .gradient-btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .gradient-btn:hover {
        background: linear-gradient(135deg, #5568d3 0%, #653a8f 100%);
      }

      .card-shadow {
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
      }

      .smooth-transition {
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }
    </style>
  </head>
  <body class="gradient-bg min-h-screen p-5 md:p-8">
    <div class="container mx-auto max-w-7xl">
      <header class="text-center text-white mb-8">
        <h1 class="text-4xl md:text-5xl font-bold mb-2 tracking-tight">
          ðŸ’° SplitEase
        </h1>
        <p class="text-lg md:text-xl opacity-90 font-light">
          Split expenses with friends, simplified
        </p>
      </header>

      <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Add Expense Form -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
          <h2 class="text-2xl font-bold text-gray-800 mb-4">Add Expense</h2>
          <form
            hx-post="/expenses/add"
            hx-target="#expenses-list"
            hx-swap="innerHTML"
            class="space-y-4"
          >
            <div>
              <label
                for="description"
                class="block text-sm font-semibold text-gray-700 mb-1"
              >
                Description
              </label>
              <input
                type="text"
                id="description"
                name="description"
                required
                placeholder="e.g., Dinner at restaurant"
                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-primary-500 smooth-transition text-sm"
              />
            </div>

            <div>
              <label
                for="amount"
                class="block text-sm font-semibold text-gray-700 mb-1"
              >
                Amount (â‚¹)
              </label>
              <input
                type="number"
                id="amount"
                name="amount"
                step="0.01"
                required
                placeholder="0.00"
                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-primary-500 smooth-transition text-sm"
              />
            </div>

            <div>
              <label
                for="paid_by"
                class="block text-sm font-semibold text-gray-700 mb-1"
              >
                Paid By
              </label>
              <select
                id="paid_by"
                name="paid_by"
                required
                class="w-full px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-primary-500 smooth-transition bg-white text-sm"
              >
                <option value="">Select user...</option>
              </select>
            </div>

            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-1">
                Split With (including payer)
              </label>
              <div
                id="split-checkboxes"
                hx-get="/users"
                hx-trigger="load, userAdded from:body, userDeleted from:body"
                hx-target="this"
                hx-swap="innerHTML"
                class="flex flex-col gap-2 max-h-32 overflow-y-auto p-3 border-2 border-gray-200 rounded-lg"
              >
                <div class="text-center text-gray-400 py-4 text-sm">
                  Loading users...
                </div>
              </div>
            </div>

            <button
              type="submit"
              class="w-full gradient-btn text-white font-semibold py-2.5 rounded-lg smooth-transition hover:-translate-y-0.5 hover:shadow-lg text-sm"
            >
              Add Expense
            </button>
          </form>
        </div>

        <!-- Tabs Section -->
        <div class="bg-white rounded-2xl p-6 card-shadow">
          <div class="flex gap-2 mb-4">
            <button
              class="tab flex-1 px-3 py-2 rounded-lg font-semibold smooth-transition gradient-btn text-white text-sm"
              onclick="showExpenses()"
            >
              Expenses
            </button>
            <button
              class="tab flex-1 px-3 py-2 rounded-lg font-semibold smooth-transition bg-gray-100 text-gray-700 hover:bg-gray-200 text-sm"
              onclick="showBalances()"
            >
              Balances
            </button>
            <button
              class="tab flex-1 px-3 py-2 rounded-lg font-semibold smooth-transition bg-gray-100 text-gray-700 hover:bg-gray-200 text-sm"
              onclick="showUsers()"
            >
              Users
            </button>
          </div>

          <!-- Expenses View -->
          <div
            id="expenses-view"
            class="max-h-[calc(100vh-20rem)] overflow-y-auto"
          >
            <div
              id="expenses-list"
              hx-get="/expenses"
              hx-trigger="load, expenseAdded from:body, expenseDeleted from:body"
              hx-swap="innerHTML"
            >
              <div class="text-center text-gray-400 py-8 text-sm">
                Loading expenses...
              </div>
            </div>
          </div>

          <!-- Balances View -->
          <div
            id="balances-view"
            class="hidden max-h-[calc(100vh-20rem)] overflow-y-auto"
          >
            <div
              id="balances-list"
              hx-get="/balances"
              hx-trigger="expenseAdded from:body, expenseDeleted from:body"
              hx-swap="innerHTML"
            ></div>
          </div>

          <!-- Users View -->
          <div
            id="users-view"
            class="hidden max-h-[calc(100vh-20rem)] overflow-y-auto"
          >
            <div
              class="bg-blue-50 border-l-4 border-blue-400 text-blue-700 p-3 rounded-lg mb-4 text-xs"
            >
              Add users who will be splitting expenses. You cannot delete users
              who have existing expenses.
            </div>
            <form
              class="flex gap-2 mb-4"
              hx-post="/users/add"
              hx-target="#users-list"
              hx-swap="innerHTML"
            >
              <input
                type="text"
                name="name"
                placeholder="Enter user name"
                required
                class="flex-1 px-3 py-2 border-2 border-gray-200 rounded-lg focus:outline-none focus:border-primary-500 smooth-transition text-sm"
              />
              <button
                type="submit"
                class="gradient-btn text-white font-semibold px-4 py-2 rounded-lg smooth-transition hover:-translate-y-0.5 hover:shadow-lg text-sm"
              >
                Add User
              </button>
            </form>
            <div
              id="users-list"
              hx-get="/users"
              hx-trigger="load, userAdded from:body, userDeleted from:body"
              hx-swap="innerHTML"
            >
              <div class="text-center text-gray-400 py-8 text-sm">
                Loading users...
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      function showExpenses() {
        document.getElementById("expenses-view").classList.remove("hidden");
        document.getElementById("balances-view").classList.add("hidden");
        document.getElementById("users-view").classList.add("hidden");

        const tabs = document.querySelectorAll(".tab");
        tabs[0].classList.add("gradient-btn", "text-white");
        tabs[0].classList.remove(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[1].classList.remove("gradient-btn", "text-white");
        tabs[1].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[2].classList.remove("gradient-btn", "text-white");
        tabs[2].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
      }

      function showBalances() {
        document.getElementById("expenses-view").classList.add("hidden");
        document.getElementById("balances-view").classList.remove("hidden");
        document.getElementById("users-view").classList.add("hidden");

        const tabs = document.querySelectorAll(".tab");
        tabs[0].classList.remove("gradient-btn", "text-white");
        tabs[0].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[1].classList.add("gradient-btn", "text-white");
        tabs[1].classList.remove(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[2].classList.remove("gradient-btn", "text-white");
        tabs[2].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );

        htmx.trigger("#balances-list", "expenseAdded");
      }

      function showUsers() {
        document.getElementById("expenses-view").classList.add("hidden");
        document.getElementById("balances-view").classList.add("hidden");
        document.getElementById("users-view").classList.remove("hidden");

        const tabs = document.querySelectorAll(".tab");
        tabs[0].classList.remove("gradient-btn", "text-white");
        tabs[0].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[1].classList.remove("gradient-btn", "text-white");
        tabs[1].classList.add(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
        tabs[2].classList.add("gradient-btn", "text-white");
        tabs[2].classList.remove(
          "bg-gray-100",
          "text-gray-700",
          "hover:bg-gray-200"
        );
      }

      // Update paid_by dropdown when users change
      document.body.addEventListener("userAdded", updatePaidByDropdown);
      document.body.addEventListener("userDeleted", updatePaidByDropdown);
      document.body.addEventListener("htmx:afterSettle", function (evt) {
        if (evt.detail.target.id === "split-checkboxes") {
          updatePaidByDropdown();
        }
      });

      function updatePaidByDropdown() {
        const checkboxes = document.querySelectorAll(
          '#split-checkboxes input[type="checkbox"]'
        );
        const select = document.getElementById("paid_by");
        const currentValue = select.value;

        // Clear existing options except first
        select.innerHTML = '<option value="">Select user...</option>';

        // Add options from users
        checkboxes.forEach((cb) => {
          const option = document.createElement("option");
          option.value = cb.value;
          option.textContent = cb.value;
          if (cb.value === currentValue) {
            option.selected = true;
          }
          select.appendChild(option);
        });
      }

      // Initial load of paid_by dropdown after a short delay
      setTimeout(updatePaidByDropdown, 500);
    </script>
  </body>
</html>
